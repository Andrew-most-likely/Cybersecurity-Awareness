<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="Assets/favicon.ico" type="image/x-icon" />
  <title>LearnCyberSafety - Login/Register</title>
  <style>
    :root {
      --bg-main: linear-gradient(135deg, #2b2d31 0%, #1e1f22 100%);
      --accent: #5865f2;
      --accent-2: #4752c4;
      --muted: #b5bac1;
      --card-bg: rgba(43, 45, 49, 0.9);
      --glass-border: rgba(255, 255, 255, 0.06);
      --text: #f2f3f5;
      --shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
      --radius: 16px;
      --glass-blur: 12px;
      --success: #3ba55c;
      --warning: #faa61a;
      --danger: #ed4245;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: url("Assets/Splash.jpg") no-repeat center/cover;
      color: var(--text);
      position: relative;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      backdrop-filter: blur(var(--glass-blur));
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 420px;
      padding: 50px 35px;
      text-align: center;
      transition: transform 0.3s ease;
      z-index: 10;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .logo-container {
      width: 300px;
      height: 300px;
      margin: auto;
      margin-top: -80px;
      margin-bottom: -40px;
      border-radius: 16px;
      overflow: hidden;
    }

    .logo-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    h1 {
      margin-bottom: 5px;
      font-size: 2rem;
      color: var(--accent);
    }

    .subtitle {
      font-size: 0.95rem;
      margin-bottom: 25px;
      color: var(--muted);
    }

    .tab-buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .tab-buttons button {
      flex: 1;
      padding: 12px 0;
      border: none;
      cursor: pointer;
      font-weight: 600;
      border-bottom: 3px solid transparent;
      background: none;
      color: var(--text);
      transition: var(--transition);
    }

    .tab-buttons button.active {
      border-color: var(--accent);
      color: var(--accent);
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 20px;
      /* even spacing between items */
    }

    .form-group {
      position: relative;
      text-align: left;
      transition: max-height 0.4s ease, opacity 0.4s ease;
      overflow: hidden;

      .background-image {
        display: none;
      }
    }

    .form-group input {
      width: 100%;
      padding: 14px 15px 14px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--glass-border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      outline: none;
      transition: var(--transition);
    }

    .form-group input:focus {
      border-color: var(--accent);
    }

    .form-group label {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 0.85rem;
      pointer-events: none;
      transition: var(--transition);
    }

    .form-group input:focus+label,
    .form-group input:not(:placeholder-shown)+label {
      top: -8px;
      left: 8px;
      font-size: 0.7rem;
      color: var(--accent);
      background: var(--card-bg);
      padding: 0 5px;
    }

    .show-password {
      position: absolute;
      right: 40px;
      top: 46%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--muted);
      font-size: 0.85rem;
      user-select: none;
    }

    .button-full {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 15px;
    }

    .button-full:hover {
      transform: translateY(-2px);
    }

    .email-btn {
      background: var(--accent);
      color: #fff;
    }

    .email-btn:hover {
      background: var(--accent-2);
    }

    .google-btn {
      background: #fff;
      color: #333;
      border: 2px solid var(--glass-border);
    }

    .google-btn:hover {
      background: #f0f0f0;
    }

    .message {
      font-size: 0.85rem;
      min-height: 22px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.4s;
    }

    .message.show {
      opacity: 1;
    }

    .forgot-button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      text-decoration: underline;
      padding: 0;
    }

    .resend-verification {
      font-size: 0.8rem;
      color: var(--accent);
      cursor: pointer;
      display: none;
    }

    .tos {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 10px;
    }

    .tos a {
      color: var(--accent);
      text-decoration: none;
    }

    @media(max-width:640px) {
      .card {
        padding: 35px 25px;
        height: 100%;
        margin-top: -40px;
        margin-bottom: 0px;
      }

      .logo-container {
        width: 140px;
        height: 140px;
      }

      h1 {
        font-size: 1.7rem;
      }
    }
  </style>
</head>

<body>
  <div class="overlay">
    <div class="card">
      <div class="logo-container">
        <img src="Assets/logo-White.png" alt="Logo" class="logo-img">
      </div>
      <h1>LearnCyberSafety</h1>
      <p class="subtitle">Master cybersecurity fundamentals</p>

      <div class="tab-buttons">
        <button id="tab-signin" class="active">Sign In</button>
        <button id="tab-register">Register</button>
      </div>

      <div id="message" class="message" role="alert"></div>

      <form id="auth-form">
        <div class="form-group">
          <input type="email" id="email" placeholder=" " aria-label="Email">
          <label for="email">Email</label>
        </div>

        <div class="form-group" id="password-group">
          <input type="password" id="password" placeholder=" " aria-label="Password" autocomplete="new-password">
          <label for="password">Password</label>
          <span class="show-password" id="toggle-password">Show</span>
        </div>

        <div class="form-group" id="confirm-group" style="max-height:0; opacity:0;">
          <input type="password" id="confirm-password" placeholder=" " aria-label="Confirm Password"
            autocomplete="new-password">
          <label for="confirm-password">Confirm Password</label>
        </div>

        <button type="button" id="forgot-password" class="forgot-button">Forgot password?</button>

        <p class="resend-verification" id="resend-verification">Resend verification email</p>

        <button id="submit-btn" class="button-full email-btn" disabled>Sign In</button>
      </form>

      <button id="google-btn" class="button-full google-btn">Sign in with Google</button>
      <p class="tos">
        By registering, you agree to our
        <a href="#" data-modal="tos">Terms of Service</a> and
        <a href="#" data-modal="privacy">Privacy Policy</a>.
      </p>
    </div>

    <div id="modal-overlay" role="dialog" aria-modal="true"
      style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); z-index:1000; justify-content:center; align-items:center;">
      <div id="modal-content"
        style="background:var(--card-bg); color:var(--text); max-width:500px; width:90%; padding:30px; border-radius:var(--radius); position:relative; text-align:left; max-height:80%; overflow-y:auto;">
        <span id="modal-close"
          style="position:absolute; top:10px; right:15px; font-weight:bold; cursor:pointer; font-size:1.2rem;">&times;</span>
        <h2 id="modal-title" style="margin-bottom:15px;">Title</h2>
        <p id="modal-text" style="line-height:1.6;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Replace
          this with your own content.</p>
      </div>
    </div>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword,
      createUserWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail,
      onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = { apiKey: "AIzaSyCgHnpzIhUtno43U3fo6rL51I-OUvyKf3U", authDomain: "learncybersafety.firebaseapp.com", projectId: "learncybersafety", storageBucket: "learncybersafety.firebasestorage.app", messagingSenderId: "793441232155", appId: "1:793441232155:web:32cbcaa870b173f1ee9fbe", measurementId: "G-2LK0NYMBHP" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const tabSignIn = document.getElementById('tab-signin'), tabRegister = document.getElementById('tab-register');
    const submitBtn = document.getElementById('submit-btn'), emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password'), confirmInput = document.getElementById('confirm-password');
    const message = document.getElementById('message'), googleBtn = document.getElementById('google-btn');
    const togglePassword = document.getElementById('toggle-password');
    const forgotPassword = document.getElementById('forgot-password'), resendVerification = document.getElementById('resend-verification');
    const authForm = document.getElementById('auth-form'), passwordGroup = document.getElementById('password-group'), confirmGroup = document.getElementById('confirm-group');

    let isRegister = false, forgotMode = false, lastSubmitTime = 0;

    function showMessage(text, color) {
      message.textContent = text; message.style.color = color; message.classList.add('show');
      setTimeout(() => message.classList.remove('show'), 4000);
    }

    function getFriendlyErrorMessage(err) {
      switch (err.code) {
        case 'auth/invalid-email': return 'Invalid email address.';
        case 'auth/email-already-in-use': return 'This email is already registered.';
        case 'auth/user-not-found': return 'No account found with this email.';
        case 'auth/wrong-password': return 'Incorrect password.';
        case 'auth/weak-password': return 'Password must be strong.';
        default: return 'Something went wrong. Please try again.';
      }
    }

    function isStrongPassword(p) {
      return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(p);
    }

    tabSignIn.addEventListener('click', () => {
      isRegister = false;
      tabSignIn.classList.add('active'); tabRegister.classList.remove('active');
      submitBtn.textContent = 'Sign In';
      toggleForgotMode(false);
      emailInput.focus();
    });
    tabRegister.addEventListener('click', () => {
      isRegister = true;
      tabRegister.classList.add('active'); tabSignIn.classList.remove('active');
      submitBtn.textContent = 'Register';
      toggleForgotMode(false);
      emailInput.focus();
    });

    togglePassword.addEventListener('click', () => {
      if (passwordInput.type === 'password') { passwordInput.type = 'text'; togglePassword.textContent = 'Hide'; }
      else { passwordInput.type = 'password'; togglePassword.textContent = 'Show'; }
    });

    function toggleForgotMode(enable) {
      forgotMode = enable;
      if (enable) {
        passwordGroup.style.display = 'none';
        confirmGroup.style.maxHeight = '0'; confirmGroup.style.opacity = '0';
        submitBtn.textContent = 'Send Reset Email';
        forgotPassword.textContent = 'Back to Sign In';
        message.classList.remove('show');
        emailInput.focus();
      } else {
        passwordGroup.style.display = 'block';
        confirmGroup.style.maxHeight = isRegister ? '80px' : '0';
        confirmGroup.style.opacity = isRegister ? '1' : '0';
        submitBtn.textContent = isRegister ? 'Register' : 'Sign In';
        forgotPassword.textContent = 'Forgot password?';
        emailInput.focus();
        message.classList.remove('show');
      }
    }

    forgotPassword.addEventListener('click', () => toggleForgotMode(!forgotMode));

    function checkInputs() {
      const emailFilled = emailInput.value.trim() !== '',
        passFilled = passwordInput.value.trim() !== '',
        confirmFilled = confirmInput.value.trim() !== '';
      submitBtn.disabled = !emailFilled || (!forgotMode && !passFilled) || (isRegister && !forgotMode && !confirmFilled);
    }

    [emailInput, passwordInput, confirmInput].forEach(el => el.addEventListener('input', checkInputs));

    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const now = Date.now();
      if (now - lastSubmitTime < 2000) { showMessage('Please wait before trying again.', 'var(--warning)'); return; }
      lastSubmitTime = now;

      const email = emailInput.value.trim(), password = passwordInput.value.trim(), confirm = confirmInput.value.trim();
      if (!email) { showMessage('Please enter your email.', 'var(--danger)'); return; }

      if (forgotMode) {
        try { await sendPasswordResetEmail(auth, email); showMessage('Password reset email sent!', 'var(--success)'); }
        catch (err) { showMessage(getFriendlyErrorMessage(err), 'var(--danger)'); }
        return;
      }

      if (!password) { showMessage('Please enter your password.', 'var(--danger)'); return; }

      if (isRegister) {
        if (!isStrongPassword(password)) { showMessage('Password must be 8+ chars, include uppercase, lowercase, number, and symbol.', 'var(--danger)'); return; }
        if (password !== confirm) { showMessage('Passwords do not match.', 'var(--danger)'); return; }
      }

      submitBtn.disabled = true; submitBtn.textContent = isRegister ? 'Registering...' : 'Signing in...';

      try {
        await setPersistence(auth, browserSessionPersistence);
        if (isRegister) {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          await sendEmailVerification(userCredential.user);
          showMessage('Registered! Please verify your email.', 'var(--success)');
          submitBtn.disabled = false; submitBtn.textContent = 'Register';
        } else {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          if (!userCredential.user.emailVerified) {
            showMessage('Please verify your email first.', 'var(--warning)');
            resendVerification.style.display = 'block';
            submitBtn.disabled = false; submitBtn.textContent = 'Sign In';
            return;
          }
          window.location.href = 'index.html';
        }
      } catch (err) {
        showMessage(getFriendlyErrorMessage(err), 'var(--danger)');
        submitBtn.disabled = false; submitBtn.textContent = isRegister ? 'Register' : 'Sign In';
        console.error(err);
      }
    });

    googleBtn.addEventListener('click', async () => {
      submitBtn.disabled = true; googleBtn.disabled = true;
      try {
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth, provider);
        window.location.href = 'index.html';
      } catch (err) {
        showMessage('Failed to sign in with Google.', 'var(--danger)');
        submitBtn.disabled = false; googleBtn.disabled = false;
      }
    });

    resendVerification.addEventListener('click', async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          await sendEmailVerification(user);
          showMessage('Verification email resent!', 'var(--success)');
          resendVerification.style.display = 'none';
        } catch (err) {
          showMessage('Failed to resend verification email.', 'var(--danger)');
        }
      }
    });

    onAuthStateChanged(auth, user => {
      if (user && user.emailVerified) window.location.href = 'index.html';
    });

    // Modal logic
    const modalOverlay = document.getElementById('modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalText = document.getElementById('modal-text');
    const modalClose = document.getElementById('modal-close');

    document.querySelectorAll('a[data-modal]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const type = link.getAttribute('data-modal');
        if (type === 'tos') {
          modalTitle.textContent = 'Terms of Service';
          modalText.innerHTML = `
        <h3>Effective Date: October 10, 2025</h3>
        <ol>
          <li><strong>Acceptance of Terms:</strong> By accessing or using LearnCyberSafety (the “Site”), you agree to be bound by these Terms of Service and all applicable laws.</li>
          <li><strong>Use of Site:</strong> You may use the Site for personal, non-commercial purposes only. You agree not to attempt unauthorized access, introduce malware, or use the Site for illegal activities.</li>
          <li><strong>Account Registration:</strong> You are responsible for maintaining the confidentiality of your login information and all activities under your account.</li>
          <li><strong>User Content:</strong> You retain ownership of content you submit but grant LearnCyberSafety a license to use it for educational purposes on the Site.</li>
          <li><strong>Prohibited Conduct:</strong> Do not impersonate others, circumvent security, or harass others using the Site.</li>
          <li><strong>Disclaimers:</strong> The Site is provided "as is." LearnCyberSafety does not guarantee accuracy, reliability, or uninterrupted access.</li>
          <li><strong>Limitation of Liability:</strong> LearnCyberSafety is not liable for damages arising from your use of the Site.</li>
          <li><strong>Modifications:</strong> We may update these Terms at any time. Continued use constitutes acceptance of changes.</li>
          <li><strong>Contact:</strong> For questions, contact us at <a href="mailto:andrewcappelli13@gmail.com">andrewcappelli13@gmail.com</a>.</li>
        </ol>
      `;
        } else if (type === 'privacy') {
          modalTitle.textContent = 'Privacy Policy';
          modalText.innerHTML = `
        <h3>Effective Date: October 10, 2025</h3>
        <ol>
          <li><strong>Information We Collect:</strong> We may collect email addresses for accounts, anonymous usage data, and feedback or content you submit.</li>
          <li><strong>How We Use Information:</strong> To provide Site functionality, send account-related emails, and improve user experience.</li>
          <li><strong>Data Sharing:</strong> We do not sell personal information. Data may be shared with service providers to operate the Site.</li>
          <li><strong>Cookies & Tracking:</strong> We may use cookies or analytics to understand traffic. No personal info is shared for marketing.</li>
          <li><strong>Security:</strong> Reasonable measures are in place to protect your data, but no online service is 100% secure.</li>
          <li><strong>User Rights:</strong> You may request deletion of your account or personal data by contacting <a href="mailto:andrewcappelli13@gmail.com">andrewcappelli13@gmail.com</a>.</li>
          <li><strong>Third-Party Links:</strong> The Site may contain links to external websites. We are not responsible for their privacy practices.</li>
          <li><strong>Policy Updates:</strong> Updates may occur periodically. Continued use indicates acceptance.</li>
        </ol>
      `;
        }
        modalOverlay.style.display = 'flex';
      });
    });


    modalClose.addEventListener('click', () => { modalOverlay.style.display = 'none'; });
    modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.style.display = 'none'; });
  </script>
</body>

</html>
